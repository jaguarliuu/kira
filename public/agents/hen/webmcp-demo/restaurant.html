<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¦ é¾™è™¾å°é¦† - WebMCP Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh;
      color: #fff;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem;
    }

    header {
      text-align: center;
      margin-bottom: 3rem;
      padding: 2rem;
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .logo {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      background: linear-gradient(90deg, #ff6b6b, #feca57);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: #888;
      font-size: 1.1rem;
    }

    .webmcp-badge {
      display: inline-block;
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background: linear-gradient(90deg, #667eea, #764ba2);
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    /* Section styles */
    .section {
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .section-title {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Menu styles */
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
    }

    .menu-item {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid rgba(255,255,255,0.1);
      transition: all 0.3s ease;
    }

    .menu-item:hover {
      background: rgba(255,255,255,0.1);
      transform: translateY(-2px);
    }

    .menu-item-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 0.5rem;
    }

    .menu-item-name {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .menu-item-price {
      color: #feca57;
      font-weight: 600;
    }

    .menu-item-desc {
      color: #888;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .menu-item-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn {
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .btn-primary {
      background: linear-gradient(90deg, #ff6b6b, #ee5a24);
      color: white;
    }

    .btn-primary:hover {
      transform: scale(1.05);
    }

    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: white;
    }

    /* Form styles */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #ccc;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 0.8rem 1rem;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      color: white;
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
      background: rgba(255,255,255,0.1);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
    }

    /* Cart styles */
    .cart {
      background: rgba(102, 126, 234, 0.1);
      border: 1px solid rgba(102, 126, 234, 0.3);
    }

    .cart-items {
      margin-bottom: 1.5rem;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background: rgba(255,255,255,0.05);
      border-radius: 8px;
      margin-bottom: 0.5rem;
    }

    .cart-item-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .cart-item-quantity {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .cart-item-quantity button {
      width: 28px;
      height: 28px;
      border: none;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      color: white;
      cursor: pointer;
      font-size: 1rem;
    }

    .cart-item-quantity span {
      min-width: 30px;
      text-align: center;
    }

    .cart-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 1rem;
      border-top: 1px solid rgba(255,255,255,0.1);
      font-size: 1.3rem;
      font-weight: 600;
    }

    .cart-total-price {
      color: #feca57;
    }

    /* Tools panel */
    .tools-panel {
      background: rgba(118, 75, 162, 0.1);
      border: 1px solid rgba(118, 75, 162, 0.3);
    }

    .tools-list {
      display: grid;
      gap: 1rem;
    }

    .tool-card {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 1.5rem;
      border-left: 4px solid #764ba2;
    }

    .tool-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .tool-card-name {
      font-family: 'Monaco', 'Consolas', monospace;
      color: #667eea;
      font-weight: 600;
    }

    .tool-card-status {
      font-size: 0.75rem;
      padding: 0.25rem 0.75rem;
      background: rgba(46, 204, 113, 0.2);
      color: #2ecc71;
      border-radius: 10px;
    }

    .tool-card-desc {
      color: #888;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }

    .tool-card-schema {
      background: rgba(0,0,0,0.3);
      border-radius: 8px;
      padding: 1rem;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 0.8rem;
      color: #aaa;
      overflow-x: auto;
    }

    /* Status messages */
    .status-message {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      padding: 1rem 1.5rem;
      background: rgba(46, 204, 113, 0.9);
      color: white;
      border-radius: 12px;
      font-weight: 500;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .status-message.show {
      transform: translateY(0);
      opacity: 1;
    }

    .status-message.error {
      background: rgba(231, 76, 60, 0.9);
    }

    /* Responsive */
    @media (max-width: 600px) {
      .form-row {
        grid-template-columns: 1fr;
      }

      h1 {
        font-size: 1.8rem;
      }

      .menu-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">ğŸ¦</div>
      <h1>é¾™è™¾å°é¦†</h1>
      <p class="subtitle">WebMCP æ™ºèƒ½é¤å…é¢„è®¢æ¼”ç¤º</p>
      <span class="webmcp-badge">ğŸ”Œ WebMCP Enabled</span>
    </header>

    <!-- WebMCP Tools Panel -->
    <div class="section tools-panel">
      <h2 class="section-title">ğŸ”§ å·²æš´éœ²çš„ WebMCP å·¥å…·</h2>
      <div class="tools-list">
        <div class="tool-card">
          <div class="tool-card-header">
            <span class="tool-card-name">get_menu</span>
            <span class="tool-card-status">å·²æ³¨å†Œ</span>
          </div>
          <p class="tool-card-desc">è·å–é¤å…èœå•åˆ—è¡¨</p>
          <div class="tool-card-schema">
Input: {} 
Returns: [{ id, name, price, description, category }]
          </div>
        </div>
        <div class="tool-card">
          <div class="tool-card-header">
            <span class="tool-card-name">add_to_cart</span>
            <span class="tool-card-status">å·²æ³¨å†Œ</span>
          </div>
          <p class="tool-card-desc">å°†èœå“æ·»åŠ åˆ°è´­ç‰©è½¦</p>
          <div class="tool-card-schema">
Input: { item_id: string, quantity: number }
Returns: { success: boolean, cart_total: number }
          </div>
        </div>
        <div class="tool-card">
          <div class="tool-card-header">
            <span class="tool-card-name">remove_from_cart</span>
            <span class="tool-card-status">å·²æ³¨å†Œ</span>
          </div>
          <p class="tool-card-desc">ä»è´­ç‰©è½¦ç§»é™¤èœå“</p>
          <div class="tool-card-schema">
Input: { item_id: string }
Returns: { success: boolean, cart_total: number }
          </div>
        </div>
        <div class="tool-card">
          <div class="tool-card-header">
            <span class="tool-card-name">get_cart</span>
            <span class="tool-card-status">å·²æ³¨å†Œ</span>
          </div>
          <p class="tool-card-desc">è·å–å½“å‰è´­ç‰©è½¦å†…å®¹</p>
          <div class="tool-card-schema">
Input: {} 
Returns: { items: [], total: number, item_count: number }
          </div>
        </div>
        <div class="tool-card">
          <div class="tool-card-header">
            <span class="tool-card-name">make_reservation</span>
            <span class="tool-card-status">å·²æ³¨å†Œ</span>
          </div>
          <p class="tool-card-desc">é¢„è®¢é¤å…åº§ä½</p>
          <div class="tool-card-schema">
Input: { 
  name: string, 
  phone: string, 
  date: string, 
  time: string, 
  party_size: number,
  special_requests?: string 
}
Returns: { success: boolean, reservation_id: string }
          </div>
        </div>
        <div class="tool-card">
          <div class="tool-card-header">
            <span class="tool-card-name">check_availability</span>
            <span class="tool-card-status">å·²æ³¨å†Œ</span>
          </div>
          <p class="tool-card-desc">æ£€æŸ¥æŒ‡å®šæ—¥æœŸæ—¶é—´æ˜¯å¦æœ‰ç©ºä½</p>
          <div class="tool-card-schema">
Input: { date: string, time: string, party_size: number }
Returns: { available: boolean, slots: string[] }
          </div>
        </div>
      </div>
    </div>

    <!-- Menu Section -->
    <div class="section">
      <h2 class="section-title">ğŸ½ï¸ èœå•</h2>
      <div class="menu-grid" id="menuGrid">
        <!-- åŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>

    <!-- Cart Section -->
    <div class="section cart">
      <h2 class="section-title">ğŸ›’ è´­ç‰©è½¦</h2>
      <div class="cart-items" id="cartItems">
        <p style="color: #888; text-align: center;">è´­ç‰©è½¦æ˜¯ç©ºçš„</p>
      </div>
      <div class="cart-total">
        <span>æ€»è®¡</span>
        <span class="cart-total-price" id="cartTotal">Â¥0</span>
      </div>
    </div>

    <!-- Reservation Form -->
    <div class="section">
      <h2 class="section-title">ğŸ“… é¢„è®¢åº§ä½</h2>
      <form id="reservationForm" tool-name="make_reservation" tool-description="é¢„è®¢é¤å…åº§ä½">
        <div class="form-row">
          <div class="form-group">
            <label for="name">å§“å</label>
            <input type="text" id="name" name="name" required 
                   tool-param-description="é¢„è®¢äººå§“å">
          </div>
          <div class="form-group">
            <label for="phone">ç”µè¯</label>
            <input type="tel" id="phone" name="phone" required
                   tool-param-description="è”ç³»ç”µè¯">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="date">æ—¥æœŸ</label>
            <input type="date" id="date" name="date" required
                   tool-param-description="é¢„è®¢æ—¥æœŸ (YYYY-MM-DD)">
          </div>
          <div class="form-group">
            <label for="time">æ—¶é—´</label>
            <select id="time" name="time" required
                    tool-param-description="é¢„è®¢æ—¶é—´">
              <option value="">é€‰æ‹©æ—¶é—´</option>
              <option value="11:00">11:00</option>
              <option value="12:00">12:00</option>
              <option value="13:00">13:00</option>
              <option value="17:00">17:00</option>
              <option value="18:00">18:00</option>
              <option value="19:00">19:00</option>
              <option value="20:00">20:00</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="partySize">ç”¨é¤äººæ•°</label>
          <input type="number" id="partySize" name="party_size" min="1" max="20" required
                 tool-param-description="ç”¨é¤äººæ•° (1-20)">
        </div>
        <div class="form-group">
          <label for="specialRequests">ç‰¹æ®Šè¦æ±‚</label>
          <textarea id="specialRequests" name="special_requests" rows="3"
                    tool-param-description="ç‰¹æ®Šè¦æ±‚ï¼ˆå¯é€‰ï¼‰"></textarea>
        </div>
        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem;">
          ç¡®è®¤é¢„è®¢
        </button>
      </form>
    </div>

    <!-- Instructions -->
    <div class="section" style="background: rgba(255,255,255,0.02);">
      <h2 class="section-title">ğŸ’¡ å¦‚ä½•æµ‹è¯•</h2>
      <ol style="color: #888; line-height: 2;">
        <li>ä½¿ç”¨ Chrome 145+ å¹¶å¯ç”¨ <code>chrome://flags</code> ä¸­çš„ WebMCP</li>
        <li>å®‰è£… <a href="https://chromewebstore.google.com/detail/model-context-tool-inspec/gbpdfapgefenggkahomfgkhfehlcenpd" style="color: #667eea;">Model Context Tool Inspector</a> æ‰©å±•</li>
        <li>åˆ·æ–°é¡µé¢ï¼Œç‚¹å‡»æ‰©å±•å›¾æ ‡æŸ¥çœ‹å·²æ³¨å†Œçš„å·¥å…·</li>
        <li>å°è¯•åœ¨ AI Agent ä¸­è¯´ï¼šã€Œå¸®æˆ‘é¢„è®¢æ˜å¤©æ™šä¸Š 7 ç‚¹ 4 ä¸ªäººçš„ä½ç½®ã€</li>
        <li>æˆ–è€…è¯´ï¼šã€Œç»™æˆ‘æ¨èå‡ ä¸ªæ‹›ç‰Œèœï¼Œç„¶åæŠŠéº»è¾£é¾™è™¾åŠ  2 ä»½åˆ°è´­ç‰©è½¦ã€</li>
      </ol>
    </div>
  </div>

  <div class="status-message" id="statusMessage"></div>

  <script>
    // ========== æ•°æ® ==========
    const menuData = [
      { id: 'lobster-spicy', name: 'éº»è¾£é¾™è™¾', price: 188, description: 'æ‹›ç‰Œå¿…ç‚¹ï¼Œç§˜åˆ¶éº»è¾£é…±', category: 'æ‹›ç‰Œ' },
      { id: 'lobster-garlic', name: 'è’œè“‰é¾™è™¾', price: 178, description: 'è’œé¦™æµ“éƒï¼Œå›å‘³æ— ç©·', category: 'æ‹›ç‰Œ' },
      { id: 'lobster-steamed', name: 'æ¸…è’¸é¾™è™¾', price: 168, description: 'åŸæ±åŸå‘³ï¼Œé²œç¾è‡³æ', category: 'æ‹›ç‰Œ' },
      { id: 'shrimp-crispy', name: 'æ¤’ç›çš®çš®è™¾', price: 98, description: 'é…¥è„†å¯å£ï¼Œä¸‹é…’ç»é…', category: 'æµ·é²œ' },
      { id: 'crab-curry', name: 'å’–å–±èŸ¹', price: 128, description: 'æ³°å¼é£å‘³ï¼Œé¦™æµ“å¯å£', category: 'æµ·é²œ' },
      { id: 'clams-spicy', name: 'è¾£ç‚’èŠ±è›¤', price: 48, description: 'é²œè¾£å¼€èƒƒï¼Œé‡å¤§å®æƒ ', category: 'å°ç‚’' },
      { id: 'tofu-mapo', name: 'éº»å©†è±†è…', price: 38, description: 'éº»è¾£é²œé¦™ï¼Œç»å…¸å·å‘³', category: 'å°ç‚’' },
      { id: 'veggie-seasonal', name: 'æ—¶è”¬', price: 28, description: 'æ¯æ—¥æ–°é²œæ—¶ä»¤è”¬èœ', category: 'ç´ èœ' },
    ];

    const cart = new Map();

    // ========== å·¥å…·å‡½æ•° ==========
    function showMessage(text, isError = false) {
      const el = document.getElementById('statusMessage');
      el.textContent = text;
      el.className = `status-message show ${isError ? 'error' : ''}`;
      setTimeout(() => el.classList.remove('show'), 3000);
    }

    function formatPrice(price) {
      return `Â¥${price}`;
    }

    // ========== UI æ¸²æŸ“ ==========
    function renderMenu() {
      const grid = document.getElementById('menuGrid');
      grid.innerHTML = menuData.map(item => `
        <div class="menu-item" data-id="${item.id}">
          <div class="menu-item-header">
            <span class="menu-item-name">${item.name}</span>
            <span class="menu-item-price">${formatPrice(item.price)}</span>
          </div>
          <p class="menu-item-desc">${item.description}</p>
          <div class="menu-item-actions">
            <button class="btn btn-primary" onclick="addToCart('${item.id}')">åŠ å…¥è´­ç‰©è½¦</button>
          </div>
        </div>
      `).join('');
    }

    function renderCart() {
      const container = document.getElementById('cartItems');
      const totalEl = document.getElementById('cartTotal');
      
      if (cart.size === 0) {
        container.innerHTML = '<p style="color: #888; text-align: center;">è´­ç‰©è½¦æ˜¯ç©ºçš„</p>';
        totalEl.textContent = 'Â¥0';
        return;
      }

      let total = 0;
      let html = '';
      
      cart.forEach((quantity, itemId) => {
        const item = menuData.find(m => m.id === itemId);
        if (item) {
          const subtotal = item.price * quantity;
          total += subtotal;
          html += `
            <div class="cart-item">
              <div class="cart-item-info">
                <span>${item.name}</span>
                <span style="color: #888;">${formatPrice(item.price)} Ã—</span>
              </div>
              <div class="cart-item-quantity">
                <button onclick="updateCart('${itemId}', -1)">-</button>
                <span>${quantity}</span>
                <button onclick="updateCart('${itemId}', 1)">+</button>
              </div>
              <span style="color: #feca57;">${formatPrice(subtotal)}</span>
            </div>
          `;
        }
      });

      container.innerHTML = html;
      totalEl.textContent = formatPrice(total);
    }

    // ========== è´­ç‰©è½¦æ“ä½œ ==========
    function addToCart(itemId, quantity = 1) {
      const current = cart.get(itemId) || 0;
      cart.set(itemId, current + quantity);
      renderCart();
      
      const item = menuData.find(m => m.id === itemId);
      showMessage(`å·²æ·»åŠ  ${item?.name || itemId}`);
    }

    function updateCart(itemId, delta) {
      const current = cart.get(itemId) || 0;
      const newQty = current + delta;
      
      if (newQty <= 0) {
        cart.delete(itemId);
      } else {
        cart.set(itemId, newQty);
      }
      renderCart();
    }

    function removeFromCart(itemId) {
      cart.delete(itemId);
      renderCart();
    }

    function getCartTotal() {
      let total = 0;
      cart.forEach((quantity, itemId) => {
        const item = menuData.find(m => m.id === itemId);
        if (item) total += item.price * quantity;
      });
      return total;
    }

    // ========== é¢„è®¢è¡¨å• ==========
    document.getElementById('reservationForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const data = {
        name: formData.get('name'),
        phone: formData.get('phone'),
        date: formData.get('date'),
        time: formData.get('time'),
        party_size: parseInt(formData.get('party_size')),
        special_requests: formData.get('special_requests') || undefined
      };

      // æ¨¡æ‹Ÿé¢„è®¢
      const reservationId = 'R' + Date.now().toString(36).toUpperCase();
      showMessage(`é¢„è®¢æˆåŠŸï¼é¢„è®¢å·ï¼š${reservationId}`);
      e.target.reset();
    });

    // ========== WebMCP å·¥å…·æ³¨å†Œ ==========
    async function registerWebMCPTools() {
      // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ WebMCP
      if (!navigator.modelContext) {
        console.log('WebMCP not supported in this browser');
        return;
      }

      try {
        // å·¥å…· 1: è·å–èœå•
        await navigator.modelContext.registerTool({
          name: 'get_menu',
          description: 'è·å–é¾™è™¾å°é¦†çš„å®Œæ•´èœå•åˆ—è¡¨',
          inputSchema: {
            type: 'object',
            properties: {}
          },
          execute: async () => {
            return {
              success: true,
              menu: menuData,
              message: 'èœå•è·å–æˆåŠŸ'
            };
          }
        });

        // å·¥å…· 2: æ·»åŠ åˆ°è´­ç‰©è½¦
        await navigator.modelContext.registerTool({
          name: 'add_to_cart',
          description: 'å°†æŒ‡å®šèœå“æ·»åŠ åˆ°è´­ç‰©è½¦',
          inputSchema: {
            type: 'object',
            properties: {
              item_id: {
                type: 'string',
                description: 'èœå“IDï¼Œå¯é€‰å€¼: lobster-spicy, lobster-garlic, lobster-steamed, shrimp-crispy, crab-curry, clams-spicy, tofu-mapo, veggie-seasonal'
              },
              quantity: {
                type: 'number',
                description: 'æ·»åŠ æ•°é‡ï¼Œé»˜è®¤ä¸º1'
              }
            },
            required: ['item_id']
          },
          execute: async ({ item_id, quantity = 1 }) => {
            const item = menuData.find(m => m.id === item_id);
            if (!item) {
              return { success: false, error: 'æœªæ‰¾åˆ°è¯¥èœå“' };
            }
            
            const current = cart.get(item_id) || 0;
            cart.set(item_id, current + quantity);
            renderCart();
            
            return {
              success: true,
              item: item.name,
              quantity_added: quantity,
              total_quantity: cart.get(item_id),
              cart_total: getCartTotal()
            };
          }
        });

        // å·¥å…· 3: ä»è´­ç‰©è½¦ç§»é™¤
        await navigator.modelContext.registerTool({
          name: 'remove_from_cart',
          description: 'ä»è´­ç‰©è½¦ä¸­ç§»é™¤æŒ‡å®šèœå“',
          inputSchema: {
            type: 'object',
            properties: {
              item_id: {
                type: 'string',
                description: 'è¦ç§»é™¤çš„èœå“ID'
              }
            },
            required: ['item_id']
          },
          execute: async ({ item_id }) => {
            if (!cart.has(item_id)) {
              return { success: false, error: 'è´­ç‰©è½¦ä¸­æ²¡æœ‰è¯¥èœå“' };
            }
            
            const item = menuData.find(m => m.id === item_id);
            cart.delete(item_id);
            renderCart();
            
            return {
              success: true,
              removed_item: item?.name,
              cart_total: getCartTotal()
            };
          }
        });

        // å·¥å…· 4: è·å–è´­ç‰©è½¦
        await navigator.modelContext.registerTool({
          name: 'get_cart',
          description: 'è·å–å½“å‰è´­ç‰©è½¦çš„å†…å®¹å’Œæ€»ä»·',
          inputSchema: {
            type: 'object',
            properties: {}
          },
          execute: async () => {
            const items = [];
            cart.forEach((quantity, itemId) => {
              const item = menuData.find(m => m.id === itemId);
              if (item) {
                items.push({
                  id: itemId,
                  name: item.name,
                  price: item.price,
                  quantity,
                  subtotal: item.price * quantity
                });
              }
            });
            
            return {
              success: true,
              items,
              total: getCartTotal(),
              item_count: items.length
            };
          }
        });

        // å·¥å…· 5: é¢„è®¢åº§ä½
        await navigator.modelContext.registerTool({
          name: 'make_reservation',
          description: 'é¢„è®¢é¤å…åº§ä½',
          inputSchema: {
            type: 'object',
            properties: {
              name: {
                type: 'string',
                description: 'é¢„è®¢äººå§“å'
              },
              phone: {
                type: 'string',
                description: 'è”ç³»ç”µè¯'
              },
              date: {
                type: 'string',
                description: 'é¢„è®¢æ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DD'
              },
              time: {
                type: 'string',
                description: 'é¢„è®¢æ—¶é—´ï¼Œå¯é€‰: 11:00, 12:00, 13:00, 17:00, 18:00, 19:00, 20:00'
              },
              party_size: {
                type: 'number',
                description: 'ç”¨é¤äººæ•° (1-20)'
              },
              special_requests: {
                type: 'string',
                description: 'ç‰¹æ®Šè¦æ±‚ï¼ˆå¯é€‰ï¼‰'
              }
            },
            required: ['name', 'phone', 'date', 'time', 'party_size']
          },
          execute: async ({ name, phone, date, time, party_size, special_requests }) => {
            // éªŒè¯
            if (party_size < 1 || party_size > 20) {
              return { success: false, error: 'ç”¨é¤äººæ•°éœ€åœ¨ 1-20 äººä¹‹é—´' };
            }
            
            // ç”Ÿæˆé¢„è®¢å·
            const reservationId = 'R' + Date.now().toString(36).toUpperCase();
            
            return {
              success: true,
              reservation_id: reservationId,
              details: {
                name,
                phone,
                date,
                time,
                party_size,
                special_requests
              },
              message: `é¢„è®¢æˆåŠŸï¼${name} æ‚¨å¥½ï¼Œæ‚¨å·²æˆåŠŸé¢„è®¢ ${date} ${time} çš„ ${party_size} äººåº§ä½ï¼Œé¢„è®¢å·ï¼š${reservationId}`
            };
          }
        });

        // å·¥å…· 6: æ£€æŸ¥ç©ºä½
        await navigator.modelContext.registerTool({
          name: 'check_availability',
          description: 'æ£€æŸ¥æŒ‡å®šæ—¥æœŸæ—¶é—´æ˜¯å¦æœ‰ç©ºä½',
          inputSchema: {
            type: 'object',
            properties: {
              date: {
                type: 'string',
                description: 'é¢„è®¢æ—¥æœŸï¼Œæ ¼å¼ YYYY-MM-DD'
              },
              time: {
                type: 'string',
                description: 'é¢„è®¢æ—¶é—´'
              },
              party_size: {
                type: 'number',
                description: 'ç”¨é¤äººæ•°'
              }
            },
            required: ['date', 'time', 'party_size']
          },
          execute: async ({ date, time, party_size }) => {
            // æ¨¡æ‹Ÿæ£€æŸ¥é€»è¾‘
            const available = Math.random() > 0.2; // 80% æ¦‚ç‡æœ‰ç©ºä½
            
            return {
              available,
              date,
              time,
              party_size,
              alternative_times: available ? [] : ['17:00', '18:00', '20:00'],
              message: available 
                ? `${date} ${time} æœ‰ ${party_size} äººç©ºä½` 
                : `${date} ${time} å·²æ»¡ï¼Œå»ºè®®é€‰æ‹©å…¶ä»–æ—¶é—´`
            };
          }
        });

        console.log('WebMCP tools registered successfully');
      } catch (error) {
        console.error('Failed to register WebMCP tools:', error);
      }
    }

    // ========== åˆå§‹åŒ– ==========
    document.addEventListener('DOMContentLoaded', () => {
      renderMenu();
      renderCart();
      registerWebMCPTools();
      
      // è®¾ç½®æ—¥æœŸé€‰æ‹©å™¨çš„æœ€å°å€¼ä¸ºä»Šå¤©
      const dateInput = document.getElementById('date');
      const today = new Date().toISOString().split('T')[0];
      dateInput.min = today;
    });
  </script>
</body>
</html>
